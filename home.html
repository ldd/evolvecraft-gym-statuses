<html lang="en">
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
   <link href="bootstrap.min.css" rel="stylesheet">
    </head>

  <body>

   <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Home</a>
          <!-- <a class="navbar-brand" href="effectiveness.htm">Effectiveness calculator</a> -->
        </div>
      </div>
    </div>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h2>Gym Leader Status on EvolveCraft</h2>
      </div>
    </div>

    <div class="container">
      <div class="row" id="wrapper">
      </div>
      <hr>
    </div> <!-- /container -->

	<script>

//JSON representing the gym leader's data
var data = {
    "regions": {
        "Kanto": {
            "cities": [
                {
                    "Pewter": {
                        "leaders": [
                            "Motocross233",
                            "justldd",
                            "Secretlaser627"
                        ]
                    }
                },
             	
             	{
                    "Cerulean": {
                        "leaders": [
                            "manbooo",
                            "IronDragon9855"
                        ]
                    }
                },

             	{
                    "Vermillion": {
                        "leaders": [
                            "DarkraiSnivy",
                            "callumlfc10",
                            "BloodPrinceXV"
                        ]
                    }
                },

              {
                    "Celadon": {
                        "leaders": [
                            "Kingdra_EX",
                            "jadenz123",
                            "Im_NooBly",
                            "kourosh2"
                        ]
                    }
                },
              {
                    "Fuchsia": {
                        "leaders": [
                            "CaptinMcPiggie",
                            "GoatSwag0723"
                        ]
                    }
                },
              {
                    "Saffron": {
                        "leaders": [
                            "MCLikeANinja",
                            "Secretlaser627"
                        ]
                    }
                },
              {
                    "Cinnabar": {
                        "leaders": [
                            "UGxUnholySage",
                            "kirby123_",
                            "96mudkip",
                            "thegamerguru97",
                            "BEijke"
                        ]
                    }
                },
              {
                    "Viridian": {
                        "leaders": [
                            "kirpi2011"
                        ]
                    }
                },

            ]
        },
        "Johto": {
            "cities": [
                {
                    "Violet": {
                        "leaders": [
                            "ProspectApex",
                            "CrassKal"
                        ]
                    }
                },
             	
             	{
                    "Azalea": {
                        "leaders": [
                            "Sir_ralph",
                            "_JustNiek"
                        ]
                    }
                },
              {
                    "Goldenrod": {
                        "leaders": [
                            "DJ_M83rt0",
                            "Sparty91103"
                        ]
                    }
                },                
              {
                    "Ecruteak": {
                        "leaders": [
                            "Osciak",
                            "bloxmiester",
                            "Killamarshall"
                        ]
                    }
                },
                {
                    "Cianwood": {
                        "leaders": [
                            "MuuuhCow",
                            "Ghostlord_tim"
                        ]
                    }
                },
              
              {
                    "Olivine": {
                        "leaders": [
                            "dukejohnston",
                            "PapoNYC",
                            "Ghostlord_Bas012",
                            "mortalcombat23"
                        ]
                    }
                },
              {
                    "Mahagony": {
                        "leaders": [
                            "Vexscream",
                            "iKrampus",
                            "mortalcombat23"
                        ]
                    }
                },                
              {
                    "Blackthorn": {
                        "leaders": [
                            "masterchief1235",
                            "jessejtj",
                            "haloman977"
                        ]
                    }
                }
            ]
        },

        "Hoenn": {
            "cities": [
                {
                    "Rustboro": {
                        "leaders": [
                            "Skelepup",
                            "DragonDescendant",
                            "MrTr4gic",
                            "Mawacate",
                            "NothingPro"
                        ]
                    }
                },
              
              {
                    "Dewford": {
                        "leaders": [
                            "TinyTom99",
                            "Killa178293",
                            "jack_epic",
                            "wayloresie"
                        ]
                    }
                },

              {
                    "Mauville": {
                        "leaders": [
                            "Phiase",
                            "the_pineapple_10",
                            "Raichulove",
                            "fro425",
                            "TheReaper313"
                        ]
                    }
                },

              {
                    "Lavaridge": {
                        "leaders": [
                            "jayrock102",
                            "thewinner123",
                            "TheReaper313",
                            "Bfish071594",
                            "HoppingFox",
                            "mortalcombat23"
                        ]
                    }
                },
              {
                    "Petalburg": {
                        "leaders": [
                            "OP_HIPPO",
                            "Noahbuddy78",
                            "SonicBoomVx"
                        ]
                    }
                },
              {
                    "Fortree": {
                        "leaders": [
                            "okanerorules",
                            "Squirrellz1",
                            "megafire13",
                            "Connorpottermore"
                        ]
                    }
                },
              {
                    "Mossdeep": {
                        "leaders": [
                            "Keaton_Ramey",
                            "mortalcombat23"
                        ]
                    }
                },
              {
                    "Sootopolis": {
                        "leaders": [
                            "killer2133",
                            "Friskeest"
                        ]
                    }
                },

            ]
        }
    }
};



	var url = "http://www.evolvecraft.com/ajax.php?s=minecraft&f=players-online-avatars&preset_id=18527811&server=combined&format=json?callback=?";
	url = 'http://query.yahooapis.com/v1/public/yql?q=' + encodeURIComponent('select * from html where url="' + url + '"') + '&format=xml';

  function ajaxGetNames(){
  initializeCities();
  $.ajax({
	dataType: "text",
	url: url,
	success: function(text){
			var xmldoc = $.parseXML(text);
			var names = $(xmldoc).find('body');

			for (index = 0; index < names.children().length; index++){
				nameImage = names.children()[index].innerHTML;
				nameString = nameImage.split('/')[4];
				nameImage = nameImage.replace('alt=""', 'title=' + nameString);
				
				//we check
				if (cities.hasOwnProperty(nameString)){

          for (var i = 0; i < cities[nameString].length; i++) {
           var city = "#" + cities[nameString][i];
           var cityInfo=nameImage; 

            $(city).append(cityInfo);
            $(city).show();
          };
				}

				
			}
      console.log('performed');
		}
	});
};
ajaxGetNames();

  var interval = 1000 * 60 * 5; //5 minutes
  setInterval(ajaxGetNames, interval);

	function initializeCities(){
    $("#wrapper").html("");
		cities = new Object();
		for (regionName in data.regions){

			$("#wrapper").append('<div class="col-md-4" id="'+regionName+'"><h3>'+regionName+' Gym Leaders</h3></div>')

			for (n = 0; n < data.regions[regionName].cities.length; n++){
				for (key in data.regions[regionName].cities[n]){

			$("#" + regionName).append('<div id="'+key+'">'+key+' Gym: </div>')
			$('#' + key).hide();

					for (i =0 ; i < data.regions[regionName].cities[n][key].leaders.length; i++){
						var name = data.regions[regionName].cities[n][key].leaders[i];

            if (cities[name] == undefined){
              cities[name] = [key];
            }
            else{
              cities[name].push(key);
            }
					}
				}
			}
		}

      };
  </script>
 
  </body>
</html>